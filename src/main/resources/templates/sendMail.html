<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<form action="/sendMail" method="post">
    <select name="dept" id="dept">
        <option value="">부서를 선택하세요</option>
        <th:block th:each="dept : ${deptList}">
            <option th:value="${dept.deptname}" th:text="${dept.deptname}"></option>
        </th:block>
    </select>

    <!-- 버튼을 클릭하여 empno를 가져오는 기능 실행 -->
    <button type="button" onclick="getEmpnos()">사원 목록 가져오기</button>

    <!-- empno를 출력할 dropdown -->
    <select name="empno" id="empno">
        <option value="">사원을 선택하세요</option>
    </select>

    제목 <input type="text" name="title">
    내용 <input type="text" name="content">
    <input type="submit" value="보내기">
</form>
<a href="/start"><input type="button" value="돌아가기"></a>

<script>
    function getEmpnos() {
        var selectedDept = $("#dept").val();
        if (selectedDept) {
            $.ajax({
                type: "GET",
                url: "/getEmpnosByDept?dept=" + selectedDept,
                dataType: "json",
                success: function (data) {
                    var empnoSelect = $("#empno");
                    empnoSelect.empty(); // 기존 옵션 제거
                    empnoSelect.append('<option value="">사원을 선택하세요</option>'); // 기본 옵션 추가

                    // JSON 배열로 파싱하여 반복
                    $.each(data, function (index, item) {
                        empnoSelect.append('<option value="' + item.empno + '">' + item.empno + '</option>');
                    });

                    // var currentEmpno = "22";
                    // var salesTeamEmpnos = ["22", "25", "27"];
                    //
                    // if(!salesTeamEmpmnos.includes(currentEmpno)) {
                    //     empnoSelect.val("");
                    // }
                }
            });
        } else {
            // 부서를 선택하지 않은 경우, 사원 목록을 비우거나 기본 옵션을 설정하세요.
            var empnoSelect = $("#empno");
            empnoSelect.empty();
            empnoSelect.append('<option value="">사원을 선택하세요</option>');
        }
    }
</script>

</body>
</html>